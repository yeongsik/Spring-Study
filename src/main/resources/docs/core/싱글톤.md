# 싱글톤

생성일: 2023년 3월 13일 오전 9:07

# 싱글톤

- JVM에 객체 인스턴스가 하나만 있어야하는 것
- 웹 어플리케이션과 싱글톤
    - 스프링 ⇒ 태생이 기업용 온라인 서비스 지원 그래서 대부분 스프링 애플리케이션은 웹 애플리케이션
    - 웹 특징 : 사용자가 동시에 요청
    - A고객 요청 → DI 컨테이너에서 객체 반환 → 다른 사용자의 같은 요청 → DI 컨테이너에서 같은 객체 생성 반환
        
        ⇒ 메모리 낭비현상 발생 → 해결책 : 해당 객체 하나만 생성하고 객체 인스턴스를 공유해서 사용하자
        
        객체를 하나만 생성하고 공유해서 사용하는 디자인 패턴 → 싱글톤 패턴
        
        - 자바 코드로 싱글톤을 구현하려고 하면 문제점
            1. 코드 수가 많아진다.
            2. 의존관계상 클라이언트가 구체클래스에 의존
            3. 유연하게 테스트하기 어렵다
            4. 내부 속성 변경 초기화 어려움
            5. private 생성자로 자식 클래스 만들기 어렵다
            
            ⇒ 결론적으로 유연성이 떨어져서 안티패턴으로 불림
            
- 스프링은 이러한 싱글톤의 단점을 제거하고 장점만 가져간다.
    - 스프링에서 싱글톤 코드를 관리하기 때문에 유연성 저하X

# 싱글톤 컨테이너

- 스프링 컨테이너 : 객체 인스턴스를 싱글톤으로 관리
    - 기본 빈 등록 방식은 싱글톤 → 다른 방식으로도 가능하나 99% 싱글톤 방식이라고 보면 된다.

# 싱글톤 방식의 주의점

- 여러 클라이언트가 하나의 인스턴스를 공유해서 사용하기 때문에 무상태로 설계해야한다.
    - 특정 클라이언트에 의존적인 필드 X
    - 값 변경 필드 X
    - 읽기만 해야한다.
    - 필드 대신 공유되지 않는 변수들을 사용 ( 지역변수, 파라미터 등 )

**⇒ 스프링 빈은 항상 무상태로 설계**

# @Configuration 과 싱글톤

@Configuration 설정한 설정 클래스가 스프링 컨테이너에 로드 될 때 해당 클래스의 객체가 등록되는 것이 아닌 내부적으로 바이트코드가 조작된 CGLIB 객체 인스턴스가 등록이 된다.

- CGLIB 객체 인스턴스란 @Configuration 클래스를 상속받은 후 싱글톤이 가능하게끔 내부적으로 바이트코드를 조작한 클래스의 인스턴스